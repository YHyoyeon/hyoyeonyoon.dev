# Portal Server Web 프로젝트 기술 스택

## 📋 개요
Softnyx Portal Server (Web + Billing) 프로젝트에서 사용된 모든 기술, 언어, 도구, 인프라를 정리한 문서입니다.

---

## 🏗️ 프로젝트 구조

### 모노레포 구조
- **패키지 매니저**: pnpm 10.24.0
- **워크스페이스**: pnpm workspace
- **구조**: 
  - `apps/`: 애플리케이션 (web, billing, auth, billing-webhook, auth-ui, admin, test-board)
  - `packages/`: 공유 패키지 (auth-core, aws-core, config, db-core, express-core, logger, redis, sentry, types, utils)

### TypeScript 프로젝트 참조
- **TypeScript**: 5.9.3
- **프로젝트 참조**: TypeScript Project References 사용
- **모듈 시스템**: NodeNext (ES Modules)
- **타겟**: ES2022

---

## 💻 프로그래밍 언어

### 주요 언어
- **TypeScript**: 5.9.3 (메인 개발 언어)
- **Node.js**: 22.20.0 (런타임 환경)
- **JavaScript**: ES2022 (컴파일 타겟)

### 보조 언어
- **Python**: 3.11 (번역 데이터 검증 스크립트)
- **YAML**: Docker Compose, GitHub Actions, Ansible 설정
- **SQL**: MySQL 데이터베이스 스키마 및 쿼리
- **Shell Script**: 배포 및 빌드 스크립트

---

## 🎯 백엔드 프레임워크 및 라이브러리

### 웹 프레임워크
- **Express.js**: 5.1.0 (웹 서버 프레임워크)
- **Node.js**: 22.20.0 (런타임)

### 의존성 주입
- **Inversify**: 6.2.2 (의존성 주입 컨테이너)
- **reflect-metadata**: 0.2.1 (메타데이터 리플렉션)

### 데이터 검증
- **Zod**: 4.1.11 (런타임 타입 검증)
- **Joi**: 17.13.3 (스키마 검증)

### HTTP 클라이언트
- **Axios**: 1.12.2 (HTTP 클라이언트)
- **superagent**: 10.1.0 (HTTP 클라이언트, override)

### 보안 및 인증
- **jsonwebtoken**: 9.0.2 (JWT 토큰 생성/검증)
- **oauth2-server**: 3.1.1 (OAuth2 서버)
- **firebase-admin**: 13.5.0 (Firebase Admin SDK)
- **helmet**: 8.1.0 (보안 헤더 설정)
- **cookie-parser**: 1.4.7 (쿠키 파싱)
- **cors**: 2.8.5 (CORS 설정)

### 유틸리티
- **compression**: 1.8.1 (응답 압축)
- **uuid**: 11.1.0 (UUID 생성)
- **dotenv**: 17.2.3 (환경 변수 관리)
- **glob**: 11.0.3 (파일 패턴 매칭)
- **serialize-error**: 12.0.0 (에러 직렬화)
- **extend**: 3.0.2 (객체 확장)
- **inflection**: 3.0.2 (단어 변형)
- **request-ip**: 3.3.0 (IP 주소 추출)
- **ua-parser-js**: 2.0.5 (User-Agent 파싱)
- **i18n-iso-countries**: 7.14.0 (국가 코드)
- **geoip-lite**: 1.4.10 (IP 지리 위치)
- **http-status-codes**: 2.3.0 (HTTP 상태 코드)

---

## 🗄️ 데이터베이스

### 관계형 데이터베이스
- **MySQL**: 8.0+ (메인 데이터베이스)
- **MySQL2**: 3.15.1 (MySQL 드라이버)
- **Sequelize**: 6.37.7 (ORM)

### NoSQL 데이터베이스
- **Redis**: 5.8.2 (캐시 및 세션 저장소)
- **ioredis**: 5.8.0 (Redis 클라이언트)

---

## ☁️ 클라우드 인프라 (AWS)

### 컴퓨팅
- **EC2**: Elastic Compute Cloud (서버 인스턴스)
- **AMI**: Amazon Machine Image (인스턴스 이미지)
- **Lambda**: Serverless Functions (서버리스 함수)
- **ALB**: Application Load Balancer (로드 밸런서)

### 스토리지
- **S3**: Simple Storage Service (정적 웹사이트 호스팅, 빌드 아티팩트 저장)
- **ECR**: Elastic Container Registry (Docker 이미지 레지스트리)

### 네트워킹
- **CloudFront**: CDN (콘텐츠 전송 네트워크)
- **API Gateway**: RESTful API 게이트웨이
- **VPC**: Virtual Private Cloud (가상 네트워크)

### 보안
- **IAM**: Identity and Access Management (권한 관리)
- **WAF**: Web Application Firewall (보안그룹으로 대체)
- **SSL/TLS**: 인증서 관리

### 모니터링 및 알림
- **CloudWatch**: 로그 모니터링 및 경보
- **SES**: Simple Email Service (이메일 발송)

### AWS SDK
- **@aws-sdk/client-s3**: 3.929.0 (S3 클라이언트)
- **@aws-sdk/s3-request-presigner**: 3.929.0 (S3 프리사인 URL)
- **@aws-sdk/client-ses**: 3.0.0 (SES 클라이언트)

---

## 🐳 컨테이너 및 오케스트레이션

### 컨테이너
- **Docker**: 컨테이너화
- **Docker Compose**: 멀티 컨테이너 오케스트레이션
- **Alpine Linux**: 경량 베이스 이미지 (node:22.20.0-alpine)

### 컨테이너 도구
- **tini**: 컨테이너 초기화 프로세스
- **curl**: 헬스체크용

---

## 🔄 CI/CD

### 지속적 통합/배포
- **Jenkins**: Linux 환경 CI/CD 서버
- **GitHub Actions**: GitHub 기반 CI/CD
  - **actions/checkout**: v4
  - **actions/setup-node**: v4
  - **actions/setup-python**: v4
  - **aws-actions/configure-aws-credentials**: v2
  - **8398a7/action-slack**: v3 (Slack 알림)

### 인프라 프로비저닝
- **Ansible**: 인프라 자동화 (QA 서버 프로비저닝)
- **Serverless Framework**: 서버리스 배포 (billing-webhook)

---

## 📊 모니터링 및 로깅

### 로깅
- **Winston**: 3.18.3 (로깅 라이브러리)
- **winston-daily-rotate-file**: 5.0.0 (일별 로그 로테이션)

### 에러 추적
- **Sentry**: @sentry/node 10.27.0 (에러 추적 및 모니터링)

### 모니터링
- **CloudWatch**: AWS 클라우드 모니터링
- **Slack**: 알림 및 모니터링 통합

---

## 🔐 인증 및 보안

### 인증 프로토콜
- **JWT**: JSON Web Token (토큰 기반 인증)
  - **알고리즘**: RS256 (RSA 서명)
  - **검증**: Issuer, Audience 검증
  - **토큰 타입**: Access Token, Refresh Token 분리
- **OAuth2**: OAuth 2.0 서버
  - **CSRF 방어**: State 파라미터 검증 (16-128자 랜덤 값)
- **OIDC**: OpenID Connect (인증 서버)
- **RSA**: RSA 키 기반 보안
  - **공개키/개인키**: RSA 키 쌍 사용
  - **키 관리**: 파일 기반 키 관리

### 소셜 로그인
- **Firebase Admin**: Google/Firebase 인증
- **SNS 연동**: 소셜 네트워크 서비스 연동

### 암호화
- **AES-256-CBC**: 대칭키 암호화 (세션 쿠키 암호화)
  - **키 생성**: SHA-256 해시
  - **IV 생성**: MD5 해시
- **MD5**: 비밀번호 해시 (레거시 호환)
  - **형식**: RIGHT(MD5(password), 20)
- **RSA**: 비대칭키 암호화 (JWT 서명)

### 쿠키 보안
- **HttpOnly**: true (JavaScript 접근 차단)
- **Secure**: 프로덕션/개발 환경에서 HTTPS 전용
- **SameSite**: 'lax' (CSRF 방어)
- **Domain**: 서브도메인 간 공유 설정
- **TTL**: 기본 1시간, 설정 가능

---

## 🛡️ 보안 방어 메커니즘

### SQL 인젝션 방어
- **ORM 사용**: Sequelize ORM을 통한 파라미터화된 쿼리
- **Prepared Statements**: 자동 파라미터 바인딩
- **입력값 이스케이프**: 
  - 작은따옴표 이스케이프 (`'` → `''`)
  - 백슬래시 이스케이프 (`\` → `\\`)
  - `dbInputString()` 함수로 수동 이스케이프 (레거시 호환)

### XSS (Cross-Site Scripting) 방어
- **입력 검증**: Zod, Joi를 통한 스키마 검증
- **프론트엔드 입력 Sanitization**: 
  - 영문, 숫자만 허용 (특수문자 제거)
  - 최대 길이 제한 (16자)
- **Helmet**: 보안 헤더 설정 (주석 처리되어 있으나 설정 가능)
- **에러 메시지**: 프로덕션 환경에서 상세 에러 메시지 숨김

### CSRF (Cross-Site Request Forgery) 방어
- **OAuth2 State 파라미터**: 16-128자 랜덤 값 검증
- **SameSite 쿠키**: 'lax' 설정으로 CSRF 공격 방어
- **Origin 검증**: CORS 설정을 통한 Origin 검증

### CORS (Cross-Origin Resource Sharing) 보안
- **Origin 화이트리스트**: 허용된 Origin만 접근 가능
- **Credentials**: 쿠키 및 인증 정보 포함 허용
- **헤더 제한**: 
  - 허용 메서드: GET, POST, PUT, PATCH, DELETE, OPTIONS
  - 허용 헤더: content-type, authorization, idempotency-key, refresh, language, x-requested-with, accept, accept-language
- **환경별 설정**: 개발/프로덕션 환경별 CORS 정책

### 입력 검증 및 Sanitization
- **Zod**: 런타임 타입 검증 및 스키마 검증
  - **검증 범위**: params, query, body
  - **에러 처리**: 환경별 상세 에러 메시지 제어
- **Joi**: 스키마 검증 (db-core, express-core)
- **프론트엔드 검증**: 
  - ID/비밀번호: 4~16자, 영문+숫자, 숫자만으로 구성 불가
  - 입력 Sanitization: 특수문자 자동 제거

### XML 인젝션 방어
- **XML 이스케이프**: 결제 서비스에서 XML 특수문자 이스케이프
  - `escapeXml()` 함수 사용
  - Payvalida 결제 연동에서 사용

### 인증/인가 보안
- **JWT 검증**: 
  - RSA 공개키로 서명 검증
  - Issuer, Audience 검증
  - 토큰 타입 검증 (Access/Refresh)
- **세션 관리**: 
  - 암호화된 세션 쿠키
  - Redis 기반 세션 저장
- **로그인 실패 정책**: 
  - 1시간 또는 하루에 5회 이상 실패 시 30분 잠금
  - (포트폴리오에 언급, 구현 여부 확인 필요)

### Rate Limiting
- **결제 API**: 30초 요청 제한 (PORTAL-615)
- **이메일 인증**: 24시간 내 5회 제한, 3분 쿨타임
- **로그인 실패**: 1시간 또는 하루에 5회 이상 시 잠금

### 에러 처리 보안
- **프로덕션 환경**: 상세 에러 메시지 숨김
- **개발 환경**: 상세 에러 메시지 표시 (디버깅용)
- **에러 로깅**: Winston을 통한 에러 로깅
- **Sentry**: 에러 추적 및 모니터링

### 네트워크 보안
- **HTTPS**: SSL/TLS 인증서 사용
- **보안그룹**: AWS 보안그룹을 통한 네트워크 접근 제어
- **WAF 대안**: S3 및 ALB의 보안그룹에서 보안 처리
- **Trust Proxy**: Express trust proxy 설정 (Docker 환경)

### 데이터 보안
- **민감 정보 마스킹**: 로깅 시 민감 정보 마스킹
- **환경 변수**: dotenv를 통한 민감 정보 관리
- **암호화된 쿠키**: AES-256-CBC로 세션 데이터 암호화

### API 보안
- **인증 미들웨어**: JWT 기반 인증 미들웨어
- **권한 검증**: 세션 쿠키 기반 권한 검증
- **캐시 제어**: 인증 관련 응답에 캐시 방지 헤더 설정
  - `Cache-Control: no-cache, no-store, must-revalidate`
  - `Pragma: no-cache`
  - `Expires: 0`

### 보안 헤더 (설정 가능)
- **Helmet**: 보안 헤더 설정 (현재 주석 처리)
  - X-Content-Type-Options
  - X-Frame-Options
  - X-XSS-Protection
  - 등

### 비밀번호 보안
- **해시 알고리즘**: MD5 (레거시 호환)
  - **형식**: RIGHT(MD5(password), 20)
  - **주의**: MD5는 보안상 취약하나 레거시 시스템 호환을 위해 사용
- **비밀번호 정책**: 
  - 4~16자
  - 영문+숫자 조합
  - 숫자만으로 구성 불가

### 결제 보안
- **결제 요청 제한**: 30초 요청 제한
- **결제 로그**: 모든 결제 요청 로깅
- **가격 검증**: 결제사별 가격 검증

---

## 🔒 보안 수준 요약

### 높은 보안 수준
1. **SQL 인젝션**: ✅ ORM 기반 파라미터화된 쿼리
2. **XSS**: ✅ 입력 검증 및 Sanitization
3. **CSRF**: ✅ SameSite 쿠키 + OAuth2 State 검증
4. **인증**: ✅ JWT (RS256) + RSA 키 기반
5. **암호화**: ✅ AES-256-CBC (세션), RSA (JWT)
6. **CORS**: ✅ Origin 화이트리스트 검증
7. **Rate Limiting**: ✅ 결제/이메일/로그인 제한

### 개선 가능 영역
1. **비밀번호 해시**: MD5 → bcrypt/argon2 권장
2. **Helmet**: 주석 처리된 보안 헤더 활성화 권장
3. **Rate Limiting**: 전역 Rate Limiting 미들웨어 추가 권장
4. **XSS**: Helmet 활성화로 추가 보안 헤더 설정 권장

---

## 📝 API 문서화

### API 문서
- **Swagger**: API 문서화
  - **swagger-jsdoc**: 6.2.8 (Swagger 주석 파싱)
  - **swagger-ui-express**: 5.0.1 (Swagger UI)

---

## 🧪 개발 도구

### 코드 품질
- **ESLint**: 9.38.0 (린터)
  - **@typescript-eslint/eslint-plugin**: 8.46.1
  - **@typescript-eslint/parser**: 8.46.1
  - **eslint-plugin-import**: 2.32.0
  - **eslint-config-prettier**: 10.1.8
- **Prettier**: 3.6.2 (코드 포맷터)
- **TypeScript**: 5.9.3 (타입 체크)

### 빌드 도구
- **tsx**: 4.20.6 (TypeScript 실행)
- **tsconfig-paths**: 4.2.0 (경로 매핑)
- **rimraf**: 6.0.1 (파일 삭제)

### 의존성 분석
- **dependency-cruiser**: 17.1.0 (의존성 그래프 분석)

---

## 📦 패키지 관리

### 패키지 매니저
- **pnpm**: 10.24.0 (패키지 매니저)
- **npm**: Node.js 기본 패키지 매니저 (일부 스크립트)

### 패키지 오버라이드
- **glob**: 7.x → 10.4.5
- **superagent**: 7.1.6 → 10.1.0
- **@effect/schema**: 최신 버전

---

## 🌐 프론트엔드 (관련)

### 프론트엔드 프레임워크
- **React**: (auth-ui, admin 앱에서 사용)
- **Next.js**: (추정, auth-ui에서 사용 가능)

---

## 🔧 개발 환경

### 운영체제
- **Linux**: Ubuntu Server 24.04 LTS (QA 서버)
- **Alpine Linux**: Docker 컨테이너 베이스
- **Windows Server**: IIS 환경 (개발 환경)

### 웹 서버
- **IIS**: Internet Information Services (Windows Server 환경)

### 개발 도구
- **Git**: 버전 관리
- **VS Code**: 개발 환경 (추정)

---

## 📚 문서화 도구

### 문서 작성
- **Markdown**: 문서 작성
- **draw.io**: 다이어그램 작성
- **Swagger**: API 문서
- **YAML**: 설정 파일

---

## 🔌 외부 서비스 연동

### 결제 서비스
- **Xsolla**: 결제 게이트웨이
- **Skrill**: 결제 게이트웨이
- **Tigo Money**: 결제 게이트웨이
- **Payvalida**: 결제 게이트웨이
- **Payletter**: 결제 게이트웨이
- **Paystation**: 결제 시스템 (v2 → v4 업그레이드)

### 블록체인
- **OpenFort API**: NFT 마켓플레이스 블록체인 연동

### 번역 서비스
- **Google Sheets API**: 번역 데이터 관리
- **Python**: 번역 검증 스크립트

---

## 🛠️ 인프라 도구

### 프로비저닝
- **Ansible**: 인프라 자동화
- **Terraform**: (추정, 인프라 코드화 가능)

### 모니터링 도구
- **Filebeat**: 로그 수집 (Ansible 설정에 언급)
- **ELK Stack**: (향후 도입 예정, 로그 분석)

---

## 📋 프로젝트 설정 파일

### 설정 파일
- **package.json**: 프로젝트 메타데이터 및 의존성
- **pnpm-workspace.yaml**: pnpm 워크스페이스 설정
- **tsconfig.json**: TypeScript 설정
- **tsconfig.base.json**: TypeScript 기본 설정
- **eslint.config.js**: ESLint 설정
- **.prettierrc**: Prettier 설정 (추정)
- **Dockerfile**: Docker 이미지 빌드
- **docker-compose.yml**: Docker Compose 설정
- **.github/workflows/**: GitHub Actions 워크플로우
- **infrastructure/**: 인프라 설정 파일

---

## 🎨 코드 스타일 및 컨벤션

### 코딩 스타일
- **인덴트**: 4 spaces
- **라인 브레이크**: Unix (LF)
- **따옴표**: Single quotes
- **세미콜론**: 필수
- **최대 라인 길이**: 100자

### 아키텍처 패턴
- **모노레포**: pnpm workspace 기반
- **마이크로서비스**: 앱별 독립 서비스
- **의존성 주입**: Inversify
- **레포지토리 패턴**: 데이터베이스 접근 추상화
- **서비스 레이어**: 비즈니스 로직 분리

---

## 📊 버전 정보

### 주요 버전
- **Node.js**: 22.20.0
- **pnpm**: 10.24.0
- **TypeScript**: 5.9.3
- **Express.js**: 5.1.0
- **Sequelize**: 6.37.7
- **Redis**: 5.8.2
- **Docker**: 최신 버전
- **Python**: 3.11

---

## 🔍 추가 기술 및 도구

### 테스트 (추정)
- **Jest**: (추정, 테스트 프레임워크)
- **Supertest**: (추정, API 테스트)

### 데이터베이스 마이그레이션
- **Sequelize Migrations**: 데이터베이스 마이그레이션

### 환경 변수 관리
- **dotenv**: 환경 변수 로드
- **환경별 설정**: dev, qa, staging, production

---

## 📝 참고사항

### 프로젝트 구조
- **모노레포**: pnpm workspace를 사용한 단일 저장소
- **패키지 구조**: apps와 packages로 분리
- **TypeScript Project References**: 프로젝트 간 의존성 관리

### 배포 환경
- **개발 환경**: Dev EC2, Docker Compose
- **QA 환경**: QA EC2, ECR, GitHub Actions
- **프로덕션 환경**: (설정 파일에 명시되지 않음)

### 보안
- **RSA 키**: 인증 및 암호화
- **환경 변수**: 민감 정보 관리
- **IAM**: AWS 권한 관리
- **보안그룹**: 네트워크 보안

---

## 📌 기술 스택 요약

### 핵심 기술
1. **언어**: TypeScript, Node.js
2. **프레임워크**: Express.js
3. **데이터베이스**: MySQL (Sequelize), Redis
4. **인프라**: AWS (EC2, S3, CloudFront, ALB, ECR, Lambda, API Gateway, SES)
5. **컨테이너**: Docker, Docker Compose
6. **CI/CD**: Jenkins, GitHub Actions
7. **모니터링**: CloudWatch, Sentry, Winston
8. **인증**: JWT, OAuth2, Firebase
9. **문서화**: Swagger, Markdown
10. **패키지 관리**: pnpm workspace

---

---

## 💻 코드 스킬 및 아키텍처 패턴

### 디자인 패턴

#### 1. Repository Pattern
- **BaseRepository**: 모든 Repository의 베이스 클래스
  - **Lazy Loading**: 모델 초기화를 지연시켜 순환 의존성 방지
  - **제네릭 타입**: `BaseRepository<T extends Model>`
  - **환경 감지**: Node.js/Next.js 환경 자동 감지
  - **모델 지연 로딩**: 실제 사용 시점에 모델 초기화
- **구현 예시**: `UserRepository`, `CashRepository`, `InquiryRepository` 등
- **특징**: 
  - 데이터베이스 접근 로직 추상화
  - 테스트 용이성 향상
  - 코드 재사용성 증대

#### 2. Service Pattern
- **비즈니스 로직 분리**: Controller와 Repository 사이의 서비스 레이어
- **의존성 주입**: Inversify를 통한 Service 주입
- **구현 예시**: 
  - `UserService`, `InquiryService`, `ContentsService`
  - `OAuth2Service`, `JWTService`, `EmailService`
- **특징**:
  - 단일 책임 원칙 준수
  - 비즈니스 로직 중앙화
  - 테스트 가능한 구조

#### 3. Singleton Pattern
- **AES 암호화 클래스**: 싱글톤 인스턴스
- **Inversify Container**: `.inSingletonScope()` 바인딩
- **Database 초기화**: Next.js 환경에서 전역 싱글톤 사용
- **구현 예시**: 
  - `AES.Instance`
  - `container.bind().inSingletonScope()`
  - `global.__dbInitState` (Next.js)

#### 4. Factory Pattern
- **동적 라우트 생성**: `route_generator.ts`
  - 컨트롤러 파일 자동 스캔
  - 메타데이터 기반 라우트 등록
  - 미들웨어 체인 자동 구성
- **Repository 팩토리**: 환경별 Repository 인스턴스 생성

#### 5. Adapter Pattern
- **RedisClientAdapter**: Redis 클라이언트 어댑터
  - Redis 구현 세부사항 추상화
  - 인터페이스 기반 설계
- **Database Adapter**: Node.js/Next.js 환경별 데이터베이스 어댑터

#### 6. Dependency Injection (DI)
- **Inversify Container**: 의존성 주입 컨테이너
  - `@injectable()` 데코레이터
  - `@inject()` 생성자 주입
  - 인터페이스 기반 바인딩
- **Service Identifier**: 타입 안전한 서비스 식별자
- **Container 계층 구조**: 
  - `auth-core` 컨테이너 (공통)
  - 앱별 컨테이너 확장 (web, billing, auth)

### 아키텍처 패턴

#### 1. Layered Architecture (계층형 아키텍처)
- **Controller Layer**: HTTP 요청/응답 처리
  - 요청 검증 (Zod)
  - 인증/인가 미들웨어
  - 응답 생성
- **Service Layer**: 비즈니스 로직 처리
  - 트랜잭션 관리
  - 데이터 변환
  - 외부 서비스 연동
- **Repository Layer**: 데이터 접근 추상화
  - 데이터베이스 쿼리
  - 모델 매핑
  - 캐싱 로직

#### 2. MVC Pattern
- **Model**: Sequelize 모델 (`BaseModel` 상속)
- **View**: JSON 응답 (RESTful API)
- **Controller**: 요청 처리 및 응답 생성

#### 3. Microservices Architecture
- **서비스 분리**: 
  - Web Server (포트 13000)
  - Billing Server (포트 13001)
  - Auth Server (포트 13002)
- **공통 패키지**: `packages/` 디렉토리
- **독립 배포**: 각 서비스별 독립 배포 가능

### 비동기 처리 패턴

#### 1. async/await 패턴
- **Promise 기반**: 모든 비동기 작업은 Promise 반환
- **에러 핸들링**: try-catch 블록으로 에러 처리
- **예시**:
  ```typescript
  async function getUser(userId: string): Promise<User | null> {
      try {
          return await this.model.findOne({ where: { Id: userId } });
      } catch (error) {
          logger.error('User 조회 실패', { error });
          throw error;
      }
  }
  ```

#### 2. Promise 체이닝
- **미들웨어 체인**: Express 미들웨어 순차 실행
- **에러 전파**: `next()` 함수를 통한 에러 전달
- **비동기 래퍼**: Promise 에러를 `next()`로 전달하는 래퍼

#### 3. 병렬 처리
- **Promise.all()**: 여러 비동기 작업 병렬 실행
- **Redis 초기화**: 여러 Redis 서비스 동시 초기화

### 타입 안정성

#### 1. TypeScript 제네릭
- **Repository 제네릭**: `BaseRepository<T extends Model>`
- **Response 제네릭**: `SuccessResponse<T>`, `ListResponse<T>`
- **Service 제네릭**: 타입 파라미터를 통한 타입 안정성
- **예시**:
  ```typescript
  export interface ListResponse<T> {
      items: T[];
      totalCount: number;
      nextOffset: number | null;
  }
  ```

#### 2. Interface 기반 설계
- **Service 인터페이스**: `IService`, `IRepository` 등
- **타입 추론**: TypeScript 컴파일러 타입 추론 활용
- **타입 가드**: 런타임 타입 검증 (Zod)

#### 3. 타입 유니온 및 인터섹션
- **에러 타입**: `ErrorMessageKey` 유니온 타입
- **요청 컨텍스트**: 인터페이스 확장
- **옵셔널 체이닝**: `?.` 연산자 활용

### 에러 처리 패턴

#### 1. RFC 7807 Problem Details
- **표준 형식**: HTTP 에러 응답 표준 형식 준수
- **구조**:
  ```typescript
  {
      type: string;      // 문제 타입 URI
      title: string;     // 문제 제목
      status: number;    // HTTP 상태 코드
      detail?: string;   // 상세 설명
      i18nKey: string;   // 다국어 키
      instance: string;  // 요청 URL
      traceId: string;   // 추적 ID
  }
  ```
- **에러 클래스**: `ErrorResponse` 클래스로 표준화

#### 2. 환경별 에러 메시지
- **개발 환경**: 상세 에러 메시지 표시
- **프로덕션 환경**: 상세 에러 메시지 숨김
- **에러 로깅**: Winston을 통한 에러 로깅

#### 3. 에러 분류
- **ValidationError**: 400 (입력 검증 실패)
- **AuthenticationError**: 401 (인증 실패)
- **AuthorizationError**: 403 (권한 없음)
- **NotFoundError**: 404 (리소스 없음)
- **ConflictError**: 409 (충돌)
- **RateLimitError**: 429 (요청 제한 초과)
- **InternalServerError**: 500 (서버 오류)

#### 4. 에러 추적
- **Sentry 통합**: 에러 추적 및 모니터링
- **Trace ID**: 요청별 고유 추적 ID (UUID)
- **에러 컨텍스트**: 요청 정보, 브라우저 정보, IP 등

### 코드 구조 및 조직

#### 1. 모노레포 구조
- **워크스페이스**: pnpm workspace
- **패키지 분리**: 
  - `apps/`: 애플리케이션
  - `packages/`: 공유 패키지
- **의존성 관리**: 워크스페이스 내부 패키지 참조 (`workspace:*`)

#### 2. 계층별 디렉토리 구조
```
apps/web/src/
├── controllers/     # 컨트롤러 레이어
├── services/        # 서비스 레이어
├── routes/          # 라우트 정의
├── loaders/         # 초기화 로더
└── utils/           # 유틸리티 함수
```

#### 3. 공통 패키지 추상화
- **express-core**: Express 공통 기능
- **db-core**: 데이터베이스 공통 기능
- **auth-core**: 인증 공통 기능
- **types**: 타입 정의 공유
- **utils**: 유틸리티 함수 공유

### 코드 품질 및 스타일

#### 1. 코드 스타일
- **인덴트**: 4 spaces
- **따옴표**: Single quotes
- **세미콜론**: 필수
- **라인 길이**: 최대 100자
- **네이밍**: 
  - 클래스: PascalCase
  - 함수/변수: camelCase
  - 상수: UPPER_SNAKE_CASE
  - 인터페이스: I 접두사 또는 PascalCase

#### 2. 코드 품질 도구
- **ESLint**: 9.38.0 (린터)
  - TypeScript 규칙
  - Import 순서 규칙
  - 코드 스타일 규칙
- **Prettier**: 3.6.2 (포맷터)
- **TypeScript**: 5.9.3 (타입 체크)
- **dependency-cruiser**: 17.1.0 (의존성 분석)

#### 3. 코드 리뷰 및 검증
- **자동 검증**: GitHub Actions에서 lint 실행
- **타입 체크**: 빌드 시 타입 검증
- **의존성 분석**: 순환 의존성 감지

### 미들웨어 패턴

#### 1. Express 미들웨어 체인
- **Request Middleware**: 요청 컨텍스트 설정
  - IP 추출
  - 브라우저 정보 파싱
  - 국가 코드 추출
  - Trace ID 생성
- **Validation Middleware**: 입력 검증 (Zod)
- **Auth Middleware**: JWT 인증 검증
- **Response Middleware**: 응답 생성 및 전송
- **Exception Middleware**: 에러 처리

#### 2. 미들웨어 순서
```
Request → Auth → Validation → Controller → Response → Exception
```

### 데이터베이스 패턴

#### 1. ORM 패턴
- **Sequelize**: ORM 사용
- **모델 정의**: `BaseModel` 상속
- **마이그레이션**: 데이터베이스 스키마 버전 관리
- **트랜잭션**: 트랜잭션 관리

#### 2. Repository 패턴
- **데이터 접근 추상화**: Repository를 통한 데이터 접근
- **쿼리 캡슐화**: 복잡한 쿼리 로직 캡슐화
- **테스트 용이성**: Mock Repository로 테스트 가능

#### 3. Lazy Loading
- **모델 지연 로딩**: 실제 사용 시점에 모델 초기화
- **순환 의존성 방지**: 초기화 순서 문제 해결
- **환경별 로딩**: Node.js/Next.js 환경별 로딩

### API 설계 패턴

#### 1. RESTful API
- **HTTP 메서드**: GET, POST, PUT, PATCH, DELETE
- **리소스 기반 URL**: `/v1/users`, `/v1/payments` 등
- **상태 코드**: 표준 HTTP 상태 코드 사용
- **응답 형식**: JSON

#### 2. 컨트롤러 메타데이터
- **Meta 객체**: 라우트 메타데이터 정의
  ```typescript
  {
      baseUrl: BaseUrl.Version1,
      url: '/users',
      method: Method.GET,
      auth: true,
      enable: true
  }
  ```
- **동적 라우트 등록**: 메타데이터 기반 자동 등록

#### 3. 응답 표준화
- **SuccessResponse**: 성공 응답 형식
- **ListResponse**: 리스트 응답 형식 (페이지네이션)
- **ErrorResponse**: 에러 응답 형식 (RFC 7807)

### 테스트 전략 (추정)

#### 1. 단위 테스트
- **Service 테스트**: 비즈니스 로직 테스트
- **Repository 테스트**: 데이터 접근 로직 테스트
- **Mock 사용**: 의존성 Mock 처리

#### 2. 통합 테스트
- **API 테스트**: 엔드포인트 통합 테스트
- **데이터베이스 테스트**: 실제 DB 연동 테스트

### 성능 최적화 패턴

#### 1. 캐싱
- **Redis 캐싱**: 자주 조회되는 데이터 캐싱
- **메타데이터 캐싱**: 1시간 TTL
- **쿼리 결과 캐싱**: 반복 쿼리 결과 캐싱

#### 2. 데이터베이스 최적화
- **파티셔닝**: 대용량 로그 테이블 파티셔닝
- **인덱싱**: 자주 조회되는 컬럼 인덱싱
- **Raw 쿼리**: 복잡한 쿼리는 Raw SQL 사용

#### 3. 응답 압축
- **compression 미들웨어**: 응답 압축 (gzip)

### 코드 재사용성

#### 1. 공통 유틸리티
- **@softnyx/utils**: 공통 유틸리티 함수
- **@softnyx/types**: 공통 타입 정의
- **@softnyx/config**: 공통 설정 관리

#### 2. 베이스 클래스
- **BaseRepository**: Repository 공통 기능
- **BaseModel**: 모델 공통 기능
- **BaseCookieService**: 쿠키 서비스 공통 기능

#### 3. 공통 미들웨어
- **express-core**: Express 공통 미들웨어
- **인증 미들웨어**: JWT 인증 공통 로직
- **검증 미들웨어**: Zod 검증 공통 로직

### 코드 문서화

#### 1. JSDoc 주석
- **함수 문서화**: 파라미터, 반환값 설명
- **클래스 문서화**: 클래스 목적 및 사용법
- **타입 문서화**: 인터페이스 및 타입 설명

#### 2. Swagger 문서화
- **API 문서**: Swagger UI를 통한 API 문서화
- **스키마 정의**: 요청/응답 스키마 정의

### 코드 버전 관리

#### 1. Git 전략
- **브랜치 전략**: feature, release 브랜치 사용
- **커밋 메시지**: 의미 있는 커밋 메시지

#### 2. 버전 관리
- **자동 버전 업데이트**: GitHub Actions에서 자동 버전 업데이트
- **의미 있는 버전**: Semantic Versioning

---

**마지막 업데이트**: 2025년 12월
**프로젝트 버전**: 1.1.0-202509080
